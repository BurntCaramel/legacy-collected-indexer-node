#!/usr/bin/env node

const fs = require('fs')
const Path = require('path')
const R = require('ramda')
const program = require('commander')
const createIndex = require('../createIndex')
const { indexFileName } = require('../constants')
const { version } = require('../package')

const writeOut = R.curry((dirPath, output) => {
    fs.createWriteStream(Path.join(dirPath, indexFileName))
        .end(output)
})

program.version(version)
    .arguments('<dirPath>')
    .action((dirPath) => {
        createIndex(Path.resolve(dirPath))
            .then(object => JSON.stringify(object, null, 2))
            .then(writeOut(dirPath))
    })
    .parse(process.argv)
