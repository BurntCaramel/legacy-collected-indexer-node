#!/usr/bin/env node

const fs = require('fs')
const Path = require('path')
const R = require('ramda')
const program = require('commander')
const hashDirectory = require('../hashDirectory')
const emojiHash = require('../emojiHash')
const { version } = require('../package')

program.version(version)
    .arguments('<dirpath>')
    .action((dirpath) => {
        hashDirectory(Path.resolve(dirpath))
            .then(R.map(
                R.converge(R.merge, [
                    R.identity,
                    R.pipe(
                        R.prop('sha256'),
                        emojiHash,
                        R.append(''),
                        R.join('  '),
                        R.objOf('emojid')
                    )
                ])
            ))
            .then(object => JSON.stringify(object, null, 2))
            .then(output => process.stdout.write(output))
    })
    .parse(process.argv)
